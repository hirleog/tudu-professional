<div class="agenda-service-list">
  <!-- Cabeçalho do dia -->
  <!-- <div
    class="day-header p-4 bg-white border-b border-gray-200 sticky top-0 z-10"
  >
    <div
      class="flex flex-col md:flex-row justify-between items-start md:items-center"
    >
      <div class="mb-3 md:mb-0">
        <h4 class="text-2xl font-bold text-gray-800 flex items-center">
          <i class="far fa-calendar-day mr-3 text-indigo-600"></i>
          <span>
            {{ selectedDate | date : "fullDate" }}
          </span>
        </h4>

        <p class="text-sm text-gray-500 mt-1 pl-8">
          <i class="fas fa-clock mr-1"></i>
          Ordenação: **Horário**
          <span class="mx-2 text-gray-400">|</span>
          <i class="fas fa-list-ol mr-1"></i>
          <span class="font-semibold text-indigo-600">
            {{ cardFiltered ? cardFiltered.length : 0 }}
          </span>
          serviço(s) agendado(s)
        </p>
      </div>

      <div class="time-indicator">
        <span
          class="inline-flex items-center px-3 py-1 text-sm font-medium rounded-full bg-indigo-100 text-indigo-700 shadow-md"
        >
          <i class="fas fa-sort-amount-down mr-2"></i>
          Ordem Cronológica
        </span>
      </div>
    </div>
  </div> -->
  <div class="services-container">
    <div class="container" *ngIf="isLoading">
      <app-card-skeleton *ngFor="let i of [1, 2, 3, 4]"></app-card-skeleton>
    </div>

    <section class="max-w-4xl mx-auto lg:px-8 pt-3">
      <div class="container" *ngIf="isLoading">
        <app-card-skeleton *ngFor="let i of [1, 2, 3, 4]"></app-card-skeleton>
      </div>

      <!-- Template Unificado -->
      <div
        class="container mx-auto"
        *ngIf="(cardFiltered && cardFiltered.length > 0) || isLoading"
      >
        <div class="row g-3 m-0 p-0">
          <!-- SERVIÇOS EM ANDAMENTO -->
          <ng-container *ngIf="selectedIndex === 0">
            <div
              class="col-12 m-0 p-0"
              *ngFor="let c of cardFiltered; let i = index"
            >
              <ng-container *ngIf="c.candidaturas && c.candidaturas.length > 0">
                <div
                  *ngFor="let candidatura of c.candidaturas; let j = index"
                  class="position-relative"
                >
                  <lib-card-layout
                    [statusPedido]="c.status_pedido"
                    [cardTemplateIndicator]="1"
                  >
                    <!-- Header -->
                    <div
                      service-icon
                      class="cursor-pointer"
                      (click)="goToDetails(c.id_pedido)"
                    >
                      <i
                        [class]="c.icon"
                        class="text-2xl"
                        style="color: var(--light) !important"
                      ></i>
                    </div>

                    <div
                      service-title
                      (click)="goToDetails(c.id_pedido)"
                      class="cursor-pointer"
                    >
                      <div>{{ c.categoria }}</div>
                    </div>

                    <div service-address>
                      <i
                        class="fas fa-map-marker-alt text-xs mr-1"
                        style="
                          font-size: 12px;
                          color: var(--primary) !important;
                        "
                      ></i>
                      {{ c.address.city }}, {{ c.address.state }} -
                      {{ c.address.neighborhood }}
                    </div>

                    <i
                      details-btn
                      (click)="goToDetails(c)"
                      class="fa-solid fa-magnifying-glass cursor-pointer"
                      style="color: var(--primary) !important"
                    ></i>

                    <div order-number>#{{ c.id_pedido }}</div>

                    <!-- Status -->
                    <div status-badge class="status-badge">
                      <i
                        class="fas fa-circle text-xs mr-1 notification-pulse"
                      ></i>
                      {{ c.status_pedido | titlecase }}
                    </div>

                    <!-- Subcategoria como tags -->
                    <div *ngIf="c.subcategoria" filter-tag class="filter-tag">
                      {{ c.subcategoria }}
                    </div>

                    <!-- Informações de valor e horário -->
                    <div info-row class="info-row flex justify-between">
                      <span class="info-label" style="color: var(--tab-link)"
                        >Valor combinado:</span
                      >
                      <span class="info-value fw-semibold">
                        {{ c.valorFormatted | currency : "BRL" }}
                      </span>
                    </div>

                    <div info-row class="info-row flex justify-between">
                      <span class="info-label" style="color: var(--tab-link)"
                        >Data combinada:</span
                      >
                      <span class="info-value fw-semibold">
                        {{
                          candidatura.horario_negociado !==
                          c.horario_preferencial
                            ? (candidatura.horario_negociado
                              | date : "dd/MM/yyyy - HH:mm")
                            : (c.horario_preferencial
                              | date : "dd/MM/yyyy - HH:mm")
                        }}
                      </span>
                    </div>

                    <!-- Footer com botões -->
                    <button
                      price
                      *ngIf="c.status_pedido !== 'cancelado'"
                      style="width: 100%"
                      class="request-quote-btn text-xs sm:text-sm md:text-base whitespace-nowrap overflow-hidden text-ellipsis"
                      (click)="startCard(cards)"
                      [ngClass]="{
                        'change-button':
                          candidatura.valor_negociado &&
                          candidatura.valor_negociado !== c.valor
                      }"
                    >
                      Iniciar
                    </button>

                    <div main-btn>
                      <button
                        class="request-quote-btn text-xs sm:text-sm md:text-base whitespace-nowrap overflow-hidden text-ellipsis"
                        (click)="goToDetails(c.id_pedido)"
                        style="
                          border: 1px solid var(--tag-p-grey);
                          color: var(--primary);
                          background-color: var(--light);
                          width: 100%;
                        "
                      >
                        <i class="fas fa-search"></i>
                        Detalhes
                      </button>
                    </div>

                    <!-- <div price>{{ card.valorFormatted | currency : "BRL" }}</div> -->
                  </lib-card-layout>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>

      <div
        *ngIf="cardFiltered && cardFiltered.length === 0 && !isLoading"
        class="empty-state-container"
      >
        <div class="empty-state-card shadow-sm rounded-4 p-5">
          <div class="empty-state-icon mb-4">
            <i
              class="fas fa-file-search"
              style="font-size: 4rem; color: #6c757d"
            ></i>
          </div>

          <div class="empty-state-content text-center">
            <h3 class="fw-bold mb-3 text-gray-800">Nenhuma Proposta</h3>

            <p class="text-muted mb-4 fs-5">Você ainda não possui pedidos</p>
          </div>
        </div>
        <div class="d-flex justify-center">
          <button
            class="btn btn-primary mt-3"
            routerLink="/tudu-professional/home"
          >
            Buscar serviços
          </button>
        </div>
      </div>

      <!-- Mensagem quando não há cards -->
      <!-- <div
    *ngIf="cards.length === 0 && !isLoading"
    class="d-flex align-items-center justify-content-center mt-5 pt-5"
    style="height: 68vh"
  >
    <div class="d-flex flex-column align-items-center gap-3">
      <i
        class="fas fa-file-lines"
        style="font-size: 5em; color: var(--tag-p-grey)"
      ></i>
      <p class="fs-3">Você ainda não possui pedidos</p>
      <button class="btn btn-primary mt-3" routerLink="/tudu-professional/home">
        Buscar serviços
      </button>
    </div>
  </div> -->
    </section>
    <!-- <div
      *ngFor="let card of card; let i = index"
      class="service-card-wrapper mb-3"
    >
      <div
        class="service-card"
        [class.blocked]="card.bloqueado"
        [class.next-in-line]="i === 0"
      >
        <div class="order-indicator" [class.active]="i === 0">
          <span class="order-number">{{ i + 1 }}</span>
        </div>

        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <div class="service-time">
            <i class="far fa-clock me-1"></i>
            <strong>{{ getServiceTime(card) | date : "HH:mm" }}</strong>
            <span class="ms-2 time-helper" *ngIf="card.statusTemporizador">
              • {{ card.statusTemporizador }}
            </span>
          </div>
          <div class="service-status">
            <span class="badge" [ngClass]="getStatusBadgeClass(card)">
              {{ card.status_pedido | titlecase }}
            </span>
          </div>
        </div>

        <div class="card-body">
         
          <div class="service-info">
            <h6 class="service-title mb-2">
              <i
                [class]="card.icon + ' me-2'"
                style="color: var(--primary)"
              ></i>
              {{ card.categoria }}
              <small class="text-muted ms-2">• {{ card.subcategoria }}</small>
            </h6>

            <div
              class="client-info mb-2"
              *ngIf="card.candidaturas && card.candidaturas.length > 0"
            >
              <i class="fas fa-user me-2 text-secondary"></i>
              <strong>{{ getClientName(card) }}</strong>
              <span class="ms-2 text-muted small" *ngIf="getClientPhone(card)">
                <i class="fas fa-phone me-1"></i>
                {{ getClientPhone(card) }}
              </span>
            </div>

            <div class="address-info mb-3">
              <i class="fas fa-map-marker-alt me-2 text-danger"></i>
              <span class="small"
                >{{ card.address?.street }}, {{ card.address?.number }}</span
              >
              <span class="ms-2 badge bg-light text-dark">
                {{ card.address?.neighborhood }}
              </span>
            </div>

            <div class="negotiated-time mb-3" *ngIf="hasNegotiatedTime(card)">
              <i class="fas fa-handshake me-2 text-success"></i>
              <span class="small">Horário acordado: </span>
              <strong class="ms-1">{{
                getNegotiatedTime(card) | date : "dd/MM/yyyy HH:mm"
              }}</strong>
            </div>

            <div class="service-details row g-2">
              <div class="col-md-6">
                <div class="detail-item">
                  <i class="fas fa-money-bill-wave me-1 text-success"></i>
                  <span>Valor:</span>
                  <strong class="ms-1">{{
                    getServiceValue(card) | currency : "BRL"
                  }}</strong>
                </div>
              </div>
              <div class="col-md-6">
                <div class="detail-item">
                  <i class="fas fa-info-circle me-1 text-info"></i>
                  <span>Status:</span>
                  <strong class="ms-1">{{
                    card.status_pedido | titlecase
                  }}</strong>
                </div>
              </div>
            </div>

            <div
              class="service-description mt-3"
              *ngIf="card.serviceDescription"
            >
              <div class="small text-muted">
                <i class="fas fa-file-alt me-1"></i>
                {{ card.serviceDescription }}
              </div>
            </div>
          </div>

          <div
            *ngIf="card.bloqueado"
            class="alert alert-warning mt-3 mb-2 py-2 small"
          >
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Atenção:</strong> Conclua o serviço anterior primeiro
            <span *ngIf="getPreviousCard(i)" class="d-block mt-1 small">
              Serviço {{ i }}: {{ getClientName(getPreviousCard(i)) }} às
              {{ getServiceTime(getPreviousCard(i)) | date : "HH:mm" }}
            </span>
          </div>
        </div>

        <div class="card-footer d-flex gap-2">
          <button
            class="btn btn-primary flex-fill"
            [disabled]="card.bloqueado || !canStartService(card)"
            (click)="onStartService(card)"
            [title]="getStartButtonTooltip(card)"
          >
            <i class="fas fa-play-circle me-1"></i>
            {{ getStartButtonText(card) }}
          </button>

          <button
            class="btn btn-outline-secondary"
            (click)="onViewDetails(card)"
            title="Ver detalhes"
          >
            <i class="fas fa-search"></i>
          </button>

          <button
            class="btn btn-outline-primary"
            (click)="onContactClient(card)"
            [disabled]="!getClientPhone(card)"
            title="Contatar cliente"
          >
            <i class="fas fa-phone"></i>
          </button>
        </div>
      </div>
    </div> -->
  </div>

  <!-- Paginação/Scroll infinito -->
  <div class="text-center mt-4" *ngIf="hasMoreCards && !isLoadingMore">
    <button class="btn btn-outline-primary" (click)="loadMore()">
      <i class="fas fa-plus me-1"></i>
      Carregar mais serviços
    </button>
  </div>

  <div class="text-center mt-2" *ngIf="isLoadingMore">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <span class="ms-2 small text-muted">Carregando mais serviços...</span>
  </div>
</div>
